
<% certification_types = get_certification_types(@task) %>
<% other_certification_types = get_other_certification_types(@task) %>
<% upload_type = get_upload_type(@task) %>
<% other_task = get_other_task(@task) %>

<h3 class = 'page-title'><%= "#{certification_types} certification for #{@product_test.cms_id} #{@product_test.name}" %></h3>

<div class = 'row'>
  <div class = 'col-sm-12'>
    <table class = 'table table-condensed execution-status-table'>
      <thead>
        <tr>
          <td class = 'col-sm-2'></td>
          <td class = 'col-sm-1'></td>
          <td class = 'col-sm-2'>QRDA Errors</td>
          <td class = 'col-sm-2'>Reporting Errors</td>
          <% if @task.product_test.product.c3_test %>
            <td class = 'col-sm-2'>Submission Errors</td>
          <% end %>
          <td class = 'col-sm-2'>Last Execution Date</td>
          <td class = 'col-sm-1'></td>
        </tr>
      </thead>
      <tbody>
        <% if @task.product_test.product.c1_test %>
          <%= render partial: 'execution_status_row', locals: { task: @task.product_test.c1_task, is_current_task: @task._type == 'C1Task' } %>
        <% end %>
        <% if @task.product_test.product.c2_test %>
          <%= render partial: 'execution_status_row', locals: { task: @task.product_test.c2_task, is_current_task: @task._type == 'C2Task' } %>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<div class = 'row'>
  <div class = 'col-sm-4'>
    <div class="well well-sm test-step">
      <h2>[1] Download Test Deck</h2>
      <div id = 'display_execution_download'>
        <%= render partial: 'execution_download', locals: { product_test: @product_test } %>
      </div>
    </div>
  </div>

  <div class = 'col-sm-8'>
    <div class="well well-sm test-step">
      <h2><%= "[2] Upload for _______" %></h2>
      <p class = 'description'>
        <%= "Upload your #{upload_type} file to get test results for #{certification_types} certifications. This will automatically run a test execution." %>
      </p>
      <%= render partial: 'execution_upload', locals: { task: @task } %>
    </div>
  </div>
</div>

<% if @task.most_recent_execution %>
  <div class = 'panel panel-default' id = 'results_panel'>
    <div class = 'panel-heading'>
      <h2>
        Results
        <label class = 'pull-right'>
          <select onchange = "location = this.options[this.selectedIndex].value;">
            <% @task.test_executions.sort_by { |obj| obj.created_at }.reverse.each_with_index do |execution, i| %>
              <option value = <%= "/tasks/#{@task.id}/test_executions/#{execution.id}" %> <%= 'selected="selected"' if execution.id == @test_execution.id %>><%= get_select_history_message(execution, i == 0) %></option>
            <% end %>
          </select>
        </label>
      </h2>
    </div>
    <div class = 'panel-body' id = 'display_execution_results' >
      <%= render partial: 'execution_results', locals: { execution: @test_execution } %>
    </div>
  </div>
<% end %>
